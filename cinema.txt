{
    "name": "Cinema",
    "version": "1.0.0",
    "author": "Julien Syx",
    "enabled": 1,
    "pypi-url": "https://pypi.python.org/pypi/lisa-plugin-Cinema",
    "github-url": "https://raw.githubusercontent.com/Seraf/LISA-PLUGINS-Cinema/master/lisa/plugins/Cinema/cinema.json",
    "description": [
        {"lang": "fr", "description": "Ce plugin donne les horaires d'un cinéma"}
    ],
    "lang": ["fr"],
    "configuration": {
        "url_Gaumont": "http://www.cinemasgaumontpathe.com/index.php?do=ajax_fiche_cinema_grille_horaire&id_cinema=",
        "salles": [
            {"id": "22", "name": "Carré Sénart", "enabled": "True", "type": "Gaumont"},
            {"id": "76", "name": "Dammarie-les-lys", "enabled": "False", "type": "Gaumont"}
        ],
        "intents": {
            "cinema_films": {
                "method": "getFilms",
                "corpus": {}
            }
        }
    }
}
.===
# -*- coding: UTF-8 -*-
import urllib
from bs4 import BeautifulSoup

from lisa.server.plugins.IPlugin import IPlugin
import gettext
import inspect
import os


class Cinema(IPlugin):
    def __init__(self):
        super(Cinema, self).__init__()
        self.configuration_plugin = self.mongo.lisa.plugins.find_one({"name": "Cinema"})
        self.path = os.path.realpath(os.path.abspath(os.path.join(os.path.split(
            inspect.getfile(inspect.currentframe()))[0],os.path.normpath("../lang/"))))
        self._ = translation = gettext.translation(domain='cinema',
                                                   localedir=self.path,
                                                   languages=[self.configuration_lisa['lang']]).ugettext

    def getFilms(self, jsonInput):
        film_str = ""
        for salle in self.configuration_plugin['configuration']['salles']:
            if salle['enabled'] == 'True':
                film_str += self._('In the theater are played these films: ') % salle['name']
                #lxml improve speed but need to be installed
                #soup = BeautifulSoup(urllib.urlopen(configuration['url_' + salle['type']] + salle['id']),"lxml")
                soup = BeautifulSoup(urllib.urlopen(self.configuration_plugin['configuration']['url_' + salle['type']] + salle['id']))
                if salle['type'] == "Gaumont":
                    film_str += self._(' then ').join(unicode(film.get_text()) for film in soup.find_all("p", class_="titre"))
        return {"plugin": "Cinema",
                "method": "getFilms",
                "body": film_str
        }
